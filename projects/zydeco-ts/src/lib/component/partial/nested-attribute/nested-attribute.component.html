<div class="accordion" [id]="getCollapsedTitle() + 'Accordion'">
    <div class="card-header" id="headingOne">
        <div class="row" *ngFor="let attribute of getFilterableKeys(); let i = index">
            <div class="col-sm-4">
                <button *ngIf="i == 1" class="btn btn-link" type="button" data-toggle="collapse" [attr.data-target]="'#' + getCollapsedTitle() + 'Collapse'" aria-expanded="true" [attr.aria-controls]="getCollapsedTitle() + 'Collapse'">
                    {{ attributeDefinition.title }}
                </button>
            </div>
            <div class="col-sm-4">
                <input
                    type="text"
                    class="form-control"
                    [(ngModel)]="filters[attribute.deltaSelector]"
                    [placeholder]="'Filter ' + attribute.title" />
            </div>
            <div class="col-sm-2">
                <!--button *ngIf="attribute.importable && i == 1" type="button" class="btn btn-primary btn-block"  data-toggle="modal" [attr.data-target]="'#bulkImport' + getTitle() + 'Modal'">
                    Bulk Import
                </button-->
            </div>
            <div class="col-sm-2">
                <button *ngIf="i == 1" type="button" class="btn btn-primary btn-block"  data-toggle="modal" [attr.data-target]="'#new' + getCollapsedTitle() + 'Modal'">
                    + New
                </button>
            </div>
        </div>
    </div>

    <div [id]="getCollapsedTitle() + 'Collapse'" class="collapse" aria-labelledby="headingOne" [attr.data-parent]="'#' + getCollapsedTitle() + 'Accordion'">

        <div class="container">
            <div class="row bg-dark text-light p-2" *ngIf="!isEmpty(); else emptyMessage">
                <div class="col">
                    <h5>Key</h5>
                </div>
                <div class="col" *ngIf="editType == 'update'">
                    <h5>Current Attributes</h5>
                </div>
                <div class="col">
                    <h5>New Attributes</h5>
                </div>
            </div>
            <ng-template #emptyMessage>
                <div class="row p-2">
                    <p>There doesn't seem to be anything here! Click the New+ button to begin.</p>
                </div>
            </ng-template>

            <ng-container *ngFor="let delta of getFilteredDeltas()">
                <div class="row p-2 border-bottom">
                    <div class="col">
                        <div class="row" *ngFor="let keyDefinition of attributeDefinition.keyDefinitions">
                            <div class="col">
                                <label class="col-form-label" [ngClass]="delta.delete == true ? 'strikethrough' : ''">
                                    <h6>{{ keyDefinition.title }}</h6>
                                </label>
                            </div>
                            <div class="col">
                                <input
                                    type="text" readonly
                                    class="form-control-plaintext"
                                    value="{{ delta.get(keyDefinition.deltaSelector) }}"
                                    [ngClass]="delta.delete == true ? 'strikethrough' : ''">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col">
                                <button type="submit" class="btn btn-primary btn-block" (click)="delta.delete = !delta.delete">
                                    {{ delta.delete ? 'Restore' : 'Delete' }}
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="col">
                        <div class="row" *ngFor="let fieldDefinition of attributeDefinition.fieldDefinitions">
                            <div class="col">
                                <label 
                                    class="col-form-label" 
                                    [ngClass]="delta.delete == true ? 'strikethrough' : ''"
                                    *ngIf="findMatchingModel(delta)">
                                    <h6>{{ fieldDefinition.title }}</h6>
                                </label>
                            </div>
                            <div class="col">
                                <input 
                                    *ngIf="findMatchingModel(delta); let model"
                                    type="text" readonly 
                                    class="form-control-plaintext" 
                                    value="{{ model.get(fieldDefinition.modelSelector) }}"
                                    [ngClass]="delta.delete == true ? 'strikethrough' : ''">
                            </div>
                        </div>
                    </div>
                    <div class="col">
                        <div class="row" *ngFor="let fieldDefinition of attributeDefinition.fieldDefinitions">
                            <div class="col">
                                <label class="col-form-label" [ngClass]="delta.delete == true ? 'strikethrough' : ''">
                                    <h6>{{ fieldDefinition.title }}</h6>
                                </label>
                            </div>
                            <div class="col">
                                <ng-container [ngSwitch]="fieldDefinition.type">
                                    <zydeco-string-attribute *ngSwitchCase="AttributeType.STRING"
                                        [attributeDefinition]="fieldDefinition"
                                        [editType]="findMatchingModel(delta) != undefined ? 'update' : 'create'") 
                                        [ngModel]="delta.get(fieldDefinition.deltaSelector)"
                                        (ngModelChange)="delta.set(fieldDefinition.deltaSelector, $event)">
                                    </zydeco-string-attribute>
                            
                                    <zydeco-date-attribute *ngSwitchCase="AttributeType.DATE"
                                        [attributeDefinition]="fieldDefinition"
                                        [editType]="findMatchingModel(delta) != undefined ? 'update' : 'create'") 
                                        [ngModel]="delta.get(fieldDefinition.deltaSelector)"
                                        (ngModelChange)="delta.set(fieldDefinition.deltaSelector, $event)">
                                    </zydeco-date-attribute>
                            
                                    <zydeco-select-attribute *ngSwitchCase="AttributeType.SELECT"
                                        [attributeDefinition]="fieldDefinition"
                                        [editType]="findMatchingModel(delta) != undefined ? 'update' : 'create'") 
                                        [ngModel]="delta.get(fieldDefinition.deltaSelector)"
                                        (ngModelChange)="delta.set(fieldDefinition.deltaSelector, $event)">
                                    </zydeco-select-attribute>
                            
                                    <zydeco-boolean-attribute *ngSwitchCase="AttributeType.BOOLEAN"
                                        [attributeDefinition]="fieldDefinition"
                                        [editType]="findMatchingModel(delta) != undefined ? 'update' : 'create'") 
                                        [ngModel]="delta.get(fieldDefinition.deltaSelector)"
                                        (ngModelChange)="delta.set(fieldDefinition.deltaSelector, $event)">
                                    </zydeco-boolean-attribute>
                            
                                    <zydeco-number-attribute *ngSwitchCase="AttributeType.NUMBER"
                                        [attributeDefinition]="fieldDefinition"
                                        [editType]="findMatchingModel(delta) != undefined ? 'update' : 'create'") 
                                        [ngModel]="delta.get(fieldDefinition.deltaSelector)"
                                        (ngModelChange)="delta.set(fieldDefinition.deltaSelector, $event)">
                                    </zydeco-number-attribute>
                                </ng-container>
                            </div>
                        </div>
                    </div>
                </div>
            </ng-container>
        </div>
    </div>
</div>

<!--resources-new-item-modal
    [title]="title"
    [mappedItems]="mappedItems"
    (create)="onNewItemCreate($event)"></resources-new-item-modal-->